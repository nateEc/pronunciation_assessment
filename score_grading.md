好的，我已经根据你提供的关于连读处理的代码，更新了发音测评的音素准确度评分规则文档。

-----

# 发音测评的音素准确度评分规则：

## 评分权重分配表

| 音素错误类型 | 扣分权重 | 重度错误(距离\>0.7) | 中度错误(距离0.3-0.7) | 轻度错误(距离\<0.3) |
|--------------|----------|-------------------|---------------------|------------------|
| 音素完全替换 | 70%      | 70%               | 35%                 | 14%              |
| 音素增加/删除 | 100%     | 100%              | 50%                 | 20%              |
| 完全不同单词 | 100%     | 100%              | 100%                | 100%             |

（ps：音素错误类型由算法基于音素相似度矩阵自动判定错误程度【重、中、轻】，扣分权重根据语音学特征计算得出。）

-----

# 详细计算规则：

## 音素级别评分：

### 音素相似度计算：

1.  **音素距离的计算：**

    > 基于语音学特征（发音部位、发音方式、清浊音等）计算两个音素之间的相似度距离。

    > 使用预定义的音素相似度矩阵：

    >   * 清浊音对立（如 p↔b）：距离 = 0.2
    >   * 发音部位相近（如 p↔t）：距离 = 0.4
    >   * 常见L2替换（如 θ→s）：距离 = 0.3
    >   * 元音高低前后变化（如 i↔ɪ）：距离 = 0.25
    >   * 完全不同类别：距离 = 1.0

2.  **错误程度分级：**

    > 根据音素距离进行分级：

    > **轻度错误：** 距离 \< 0.3 （如清浊音混淆）

    > **中度错误：** 距离 0.3 \~ 0.7 （如发音部位错误）

    > **重度错误：** 距离 \> 0.7 （如元音辅音混淆）

### 单词/短语级别评分：

1.  **完全不同单词检测：**

    > 通过以下条件判定两个单词或短语是否完全不同：

    >   * 无共同音素
    >   * 音素重叠度 \< 20%
    >   * 长度差异 \> 3倍
    >   * 无位置对应关系

    > 若检测为完全不同，直接得分 = **0分**

2.  **音素编辑距离计算：**

    > 使用改进的编辑距离算法：

    >   * 将多字符音素（如 tʃ, aɪ, θ）作为单个单位处理
    >   * 根据音素相似度矩阵计算替换成本
    >   * 插入/删除操作成本 = 1.0
    >   * 替换操作成本 = 音素距离值

3.  **最终评分计算：**

    > 基于标准化编辑距离计算得分：

    > ```
    > 标准化距离 = 编辑距离 / max(实际音素数, 标准音素数)
    > 惩罚因子 = 标准化距离 ^ 0.7  # 使用幂函数减轻惩罚
    > 原始得分 = 100 * (1 - 惩罚因子 * 0.6)  # 最大扣分60%
    > 最终得分 = max(原始得分, 0)
    > ```

## 短语连读处理：

1.  **连读现象考量：**

    > 对于短语的评分，算法会特别考虑英语中的\*\*连读（Connected Speech）\*\*现象，如同化（Assimilation）、省音（Elision）、连音（Linking R, Intrusive R/W）等。
    > 这意味着短语中的单词发音可能与单独发音时有所不同，算法会对此进行适应。

2.  **标准发音变体生成：**

    > 算法会根据预设的连读规则（例如：`d + j` 变为 `dʒ` 如 "did you" -\> "didja"；`t + j` 变为 `tʃ` 如 "get you" -\> "getcha"；元音后的连读 `r`, `j`, `w` 等），为标准发音生成一个或多个可能的连读变体。
    > 此外，还包含一些特定短语的常见连读模式（如 "not at" -\> "not-a"）。

3.  **多变体最佳匹配：**

    > 用户发音将与所有生成的标准发音连读变体逐一进行音素编辑距离计算和评分。
    > 最终得分取所有变体中计算出的**最高分**，以确保算法能捕捉到用户最接近标准发音（包括连读形式）的表现。

4.  **回退机制：**

    > 如果用户发音与所有连读变体匹配后得分仍为0（或非常低），算法会回退到不考虑连读的单字评估逻辑进行二次计算，以提供更基础的评估。

## 评分示例：

### 示例1：轻度错误 (单字)

  * **输入：** 用户发音 "lɪk" vs 标准发音 "laɪk" （like单词）
  * **分析：** 双元音 aɪ → 单元音 ɪ，音素距离 = 0.5（中度错误）
  * **计算：** 1个音素错误，标准化距离 = 1/3 = 0.33
  * **得分：** 约 **85分**

### 示例2：中度错误 (单字)

  * **输入：** 用户发音 "sɪŋk" vs 标准发音 "θɪŋk" （think单词）
  * **分析：** θ → s 替换，音素距离 = 0.3（常见L2错误）
  * **计算：** 1个音素错误，标准化距离 = 1/4 = 0.25
  * **得分：** 约 **80分**

### 示例3：重度错误 (完全不同单词)

  * **输入：** 用户发音 "tʃoɪs" vs 标准发音 "θɪŋk" （choice vs think）
  * **分析：** 完全不同单词，无共同音素
  * **判定：** 触发"完全不同单词"检测
  * **得分：** **0分**

### 示例4：完美发音 (单字)

  * **输入：** 用户发音 "laɪk" vs 标准发音 "laɪk" （like单词）
  * **分析：** 完全匹配
  * **得分：** **100分**

### 示例5：连读处理 (短语)

  * **输入：** 用户发音 "dɪʤu" vs 标准发音 "dɪdju" （did you 短语）
  * **分析：** `dɪdju` 通过连读规则生成变体 `dɪdʒu` (或 `dɪʤu`)，用户发音与此变体完美匹配。
  * **得分：** 约 **100分** （若不考虑连读，可能会因为 `d` 和 `dʒ` 的差异而扣分）

### 示例6：连读处理 (短语)

  * **输入：** 用户发音 "wʌdə" vs 标准发音 "wʌtdu" （what do 短语）
  * **分析：** `wʌtdu` 通过连读规则生成变体 `wʌdə`，用户发音与此变体完美匹配。
  * **得分：** 约 **100分**

## 算法优势：

1.  **语音学准确性：** 基于真实的语音学特征进行评分
2.  **L2学习者友好：** 对常见的二语学习者错误给予适当宽容
3.  **多字符音素处理：** 正确处理复合音素如双元音、塞擦音等
4.  **智能区分：** 能够区分发音尝试和完全错误的单词
5.  **短语连读支持：** 能够识别和适应英语口语中自然的连读现象，提供更贴近实际的短语发音评估。

## 注意事项：

  * 该算法专注于**音素准确度**评估，不包括语调、重音、流畅度等超音段特征
  * 评分范围为 0-100 分，可根据需要转换为其他评分标准
  * 对于极短单词（1-2个音素），评分可能相对较为严格